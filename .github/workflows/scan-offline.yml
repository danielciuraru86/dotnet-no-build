name: Scan Offline

on:
  push:
    branches:
      - trivy-offline  # Trigger for the feature branch

jobs:
  Scan:
    runs-on: ubuntu-latest

    steps:

      # Step 1: Checkout the repository code
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Step 2: Setup .NET SDK
      - name: Setup .NET SDK
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '9.0'

      # Step 3: Restore .NET dependencies and update lock file
      - name: Restore and update lock file
        run: dotnet restore ./src/MySampleDotNetApp/MySampleDotNetApp.csproj --use-lock-file --force-evaluate

      # Step 4: Download Trivy DB if available from cache
      - name: Cache Trivy DB
        uses: actions/cache@v3
        with:
          path: /tmp/.cache/trivy
          key: trivy-db-${{ runner.os }}-${{ hashFiles('**/*.csproj') }}  # Use a unique key
          restore-keys: |
            trivy-db-${{ runner.os }}-
            trivy-db-
